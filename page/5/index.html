<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <!-- this tag should remove when publish production  -->
  <meta name="”robots”" content="”noindex”">
  

  
  <title>Japan Azure Identity Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。">
<meta name="keywords" content="Azure,Azure AD,Identity,AD FS">
<meta property="og:type" content="website">
<meta property="og:title" content="Japan Azure Identity Support Blog">
<meta property="og:url" content="https://jpazureid.github.io/page/5/index.html">
<meta property="og:site_name" content="Japan Azure Identity Support Blog">
<meta property="og:description" content="日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。">
<meta property="og:locale" content="ja">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Japan Azure Identity Support Blog">
<meta name="twitter:description" content="日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。">
  
    <link rel="alternate" href="../../atom.xml" title="Japan Azure Identity Support Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="../../css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../index.html" id="logo">Japan Azure Identity Support Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="../../index.html">Home</a>
        
          <a class="main-nav-link" href="../../archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="../../atom.xml" title="RSSフィード"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="検索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jpazureid.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-azure-active-directory/member-and-guest-user" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/12/12/azure-active-directory/member-and-guest-user/" class="article-date">
  <time datetime="2017-12-11T15:00:00.000Z" itemprop="datePublished">2017-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/12/12/azure-active-directory/member-and-guest-user/">Member ユーザーと Guest ユーザーについて</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの坂井です。</p>
<p>Azure AD に所属しているユーザーの種類として、下記のように 「Member」 と 「Guest」があります。今回は、こちらのユーザーの種類について説明します。</p>
<img src="/blog/2017/12/12/azure-active-directory/member-and-guest-user/member-and-guest.png">
<h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>下記のように、個人アカウントや別テナントの職場または学校アカウント (組織アカウント) を追加した (Azure AD B2B の機能を利用した) 場合に、ユーザーの種類が 「Guest」 として追加されます。</p>
<img src="/blog/2017/12/12/azure-active-directory/member-and-guest-user/personal-work-account.png">
<p>これ以外の Azure のサブスクリプションのサインアップで利用した個人アカウントや組織内のドメイン (上記の例の場合：contso.com) をユーザー名 (例：<a href="mailto:test@contoso.com" target="_blank" rel="noopener">test@contoso.com</a>) に持つユーザーは「Member」として登録されます。また、クラシックポータル  (旧ポータル) より追加した外部ユーザーについては 「Member」として登録されております。</p>
<h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>既定ではゲスト ユーザーに対しては、 Azure AD のデータへのアクセスを制限しています。そのため、ゲスト ユーザーでサインインした場合、招待された Azure AD のユーザーの一覧を参照することもできませんし、各種設定の参照・変更も制限されています。もちろん、サブスクリプションに対する権限を付与していない場合は、サブスクリプションのリソースを操作することもできません。<br>(一般ユーザーとゲスト ユーザーがそれぞれできること (アクセス許可の比較) は、こちらをご参照ください。)</p>
<img src="/blog/2017/12/12/azure-active-directory/member-and-guest-user/access-denied.png">
<img src="/blog/2017/12/12/azure-active-directory/member-and-guest-user/no-access-permission.png">
<p>ゲストに対するアクセス制限は、以下の赤枠の箇所 (ゲストのアクセス許可を制限する) で変更できます。この設定が “はい” の場合には「Guest」の操作は上記のように制限されています。</p>
<img src="/blog/2017/12/12/azure-active-directory/member-and-guest-user/guest-users-permissions-are-limited.png">
<p>ユーザーの属性については、PowerShell を利用することで Member から Guest、またその逆についても変更が可能です。Guest から Member  に変更する際は「Guest」に対して行っていた制御の対象外のユーザーとなるため、セキュリティポリシーに沿った対応や特定のユーザーに絞った設定変更をお勧め致します。</p>
<h2 id="ユーザー-タイプ変更手順"><a href="#ユーザー-タイプ変更手順" class="headerlink" title="ユーザー タイプ変更手順"></a>ユーザー タイプ変更手順</h2><p>この作業を実施するためには、Azure AD 用の PowerShell (Azure AD v1 の PowerShell) を利用する必要がありますが、 PowerShell を利用する際には Microsoft アカウントではなく、組織アカウントでの全体管理者が必要です (Azure AD の PowerShell については <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/04/aad-powershell/" target="_blank" rel="noopener">リンク</a> も参照ください)。そのために対処策は次の手順で実施する必要があります。</p>
<ol>
<li>Azure AD の全体管理者アカウントを作成する (※すでに組織アカウントの全体管理者が存在する場合は、スキップ)</li>
<li>PowerShell を実行し、該当ユーザーを 「Guest」 から 「Member」 に変更する</li>
</ol>
<h3 id="1-Azure-AD-の全体管理者アカウントを作成する-※すでに組織アカウントの全体管理者が存在する場合は、スキップ"><a href="#1-Azure-AD-の全体管理者アカウントを作成する-※すでに組織アカウントの全体管理者が存在する場合は、スキップ" class="headerlink" title="1. Azure AD の全体管理者アカウントを作成する (※すでに組織アカウントの全体管理者が存在する場合は、スキップ)"></a>1. Azure AD の全体管理者アカウントを作成する (※すでに組織アカウントの全体管理者が存在する場合は、スキップ)</h3><ol>
<li>Azure ポータルにサインインします。</li>
<li>Azure Active Directory を開き、[ドメイン名] を開きます。</li>
<li>一覧に表示されている名前で onmicrosoft.com を含む名前を控えておきます。</li>
<li>[ユーザーとグループ] - [すべてのユーザー] と辿り、右ペインの上部にある [+ 新しいユーザー] をクリックします。</li>
<li>名前欄に適当な例えば admin1 などを入力し、 ユーザー名として 1-3 で確認した onmicrosoft.com のドメイ<br>ン名と名前欄に設定したものを組み合わせて <a href="mailto:admin1@contoso.onmicrosoft.com" target="_blank" rel="noopener">admin1@contoso.onmicrosoft.com</a> というように入力します。</li>
<li>ディレクトリ ロール欄で “全体管理者” を選択し、 [OK] をクリックします。</li>
<li>“パスワードを表示” をクリックし、パスワードを控えて [作成] をクリックします。</li>
</ol>
<h3 id="2-PowerShell-を実行し、該当ユーザーを-Guest-から-Member-に変更する"><a href="#2-PowerShell-を実行し、該当ユーザーを-Guest-から-Member-に変更する" class="headerlink" title="2. PowerShell を実行し、該当ユーザーを Guest から Member に変更する"></a>2. PowerShell を実行し、該当ユーザーを Guest から Member に変更する</h3><ol>
<li>Azure AD 用の PowerShell (Azure AD v1 の MSOnline の PowerShell) を起動します。<br>※モジュールの入手方法については、弊社ブログをご参照ください。インストールされていない環境では 1. MSOnline (Azure AD v1) のインストールをお願いします。</li>
<li>以下のコマンドを実行します。<br>Connect-MsolService</li>
<li>資格情報の入力を求められるため、1 で作成したアカウントの情報を入力します。<br>このときパスワードの変更が求められるはずですので、パスワードを新しく設定します。</li>
<li><p>以下のコマンドを実行して、対象ユーザーの UserPrincipalName および UserType 属性値を確認します。</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-MsolUser -All | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure>
<p> 出力例:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">User1_live.com#EXT#@contoso.onmicrosoft.com   Guest  -&gt; 「Guest」 であることが確認できます。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li><p>以下のコマンドを実行して、対象ユーザーの UserType を 「Member」 に変更します。</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-MsolUser -UserPrincipalName &lt;対象ユーザーの UserPrincipalName&gt; -UserType Member</span><br></pre></td></tr></table></figure>
<p> 実行例:</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-MsolUser -UserPrincipalName User1_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com -UserType Member</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li><p>再度以下のコマンドを実行して、対象ユーザーの UserType を確認します。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-MsolUser -All | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure>
<p>出力例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">User1_live.com#EXT#@contoso.onmicrosoft.com   Member  -&gt; 変更されたことを確認します。</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>「Member」→「Guest」に変更する場合は、UserType に 「Guest」を指定します。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-MsolUser -UserPrincipalName &lt;対象ユーザーの UserPrincipalName&gt; -UserType Guest</span><br></pre></td></tr></table></figure>
<p>上記内容が少しでも皆様の参考となりますと幸いです。</p>
<h2 id="変更履歴"><a href="#変更履歴" class="headerlink" title="変更履歴"></a>変更履歴</h2><ul>
<li>2017/12/12: 公開しました。</li>
<li>2018/02/26: Microsoft Connect のリタイアに伴い MSOnline モジュールのダウンロードができなくなったため記載を変更しました。</li>
<li>2018/10/31: メンバーとゲストの既定のアクセス許可の比較情報のリンクを追加しました。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/12/12/azure-active-directory/member-and-guest-user/" data-id="cjtqwo5ti0010e4yt70gnzxm2" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD-B2B/">Azure AD B2B</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory/what-is-b2b" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/12/12/azure-active-directory/what-is-b2b/" class="article-date">
  <time datetime="2017-12-11T15:00:00.000Z" itemprop="datePublished">2017-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/12/12/azure-active-directory/what-is-b2b/">Azure AD B2B とは</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの坂井です。</p>
<p>今回は Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) について紹介します。</p>
<p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b</a></p>
<p>この機能については、上記のリンクでも紹介しています。Azure AD B2B と聞くと、もしかしたら小難しく聞こえるかもしれませんが、要は、他 Azure AD のユーザーを追加 (招待) する機能のことです。具体的には、Azure AD を利用する中で、次のような要望がでてくることがあります。</p>
<ul>
<li>会社間 (Azure AD 間) でリソースを共有したい</li>
<li>別の Azure AD に紐づいているリソースを使用したい</li>
<li>ひとりの管理者で、複数の Azure AD を管理したい</li>
<li>など</li>
</ul>
<p>このような連携が必要な時に、利用する機能が、今回ご紹介する Azure AD B2B になります。</p>
<h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p> Azure サブスクリプションは必ず 1 つの Azure AD に関連付けられています。<br>そのため、その関連付けられた Azure AD に所属しているユーザーのみがそのサブスクリプションに紐づくリソースを利用可能です。</p>
<img src="/blog/2017/12/12/azure-active-directory/what-is-b2b/subscription-user.png">
<p>では、複数の Azure AD がある場合はどのようになるでしょうか。<br>この場合、別の Azure AD へのアクセスや別の Azure AD に関連付けられているサブスクリプションにアクセスできません。</p>
<img src="/blog/2017/12/12/azure-active-directory/what-is-b2b/subscription-user-inaccessible.png">
<p>こんな時、Azure AD B2B を利用することで、別 Azure AD にユーザーを追加(コピーのようなイメージ)することで、別の Azure AD に所属してリソースを利用することが可能です。</p>
<img src="/blog/2017/12/12/azure-active-directory/what-is-b2b/invite-user-to-tenant.png">
<h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>別の Azure AD のユーザーを追加する方法で多く利用されるものを  2  つ紹介します。</p>
<h3 id="1-ゲスト-ユーザーの追加"><a href="#1-ゲスト-ユーザーの追加" class="headerlink" title="1. ゲスト ユーザーの追加"></a>1. ゲスト ユーザーの追加</h3><p>明示的に別の Azure AD (または outlook.com や gmail.com などのマイクロソフト アカウント) を追加する操作です。Azure ポータルのメニューより [Azure Active Directory] – [ユーザーとグループ] – [すべてのユーザー] の順に進みます。下記、[新しいゲスト ユーザー] から別の Azure AD のユーザーを追加できます。招待メールが送られ、そのメールよりウィザードを完了する必要があります。</p>
<img src="/blog/2017/12/12/azure-active-directory/what-is-b2b/screenshot-new-guest-user.png">
<h3 id="2-RBAC-アクセス制御-IAM-によるユーザーの追加"><a href="#2-RBAC-アクセス制御-IAM-によるユーザーの追加" class="headerlink" title="2. RBAC (アクセス制御 IAM) によるユーザーの追加"></a>2. RBAC (アクセス制御 IAM) によるユーザーの追加</h3><p>RBAC では、Azure サブスクリプションに紐づけられている Azure AD のユーザーに対してアクセス権を割り当てる必要があります。では、RBAC でアクセス権を割り当てるときに別の Azure AD のユーザーに対してアクセス権を割り当てるときには、先に 1 の作業を実施しておく必要があるのでしょうか？</p>
<p>いいえ、もしユーザーが存在していない場合には、 1 のユーザー追加も合わせて行われます。<br>Azure ポータルの [サブスクリプション] – [サブスクリプション名] – [アクセス制御 (IAM)]の順に進みます。</p>
<p>下記、[追加] から別の Azure AD のユーザーを追加することができます。招待メールが送られ、そのメールよりウィザードを完了する流れは同様になりますが、同時にサブスクリプションに対するロールを割り当てられます。</p>
<img src="/blog/2017/12/12/azure-active-directory/what-is-b2b/screenshot-iam.png">
<h2 id="よくあるお問い合わせ"><a href="#よくあるお問い合わせ" class="headerlink" title="よくあるお問い合わせ"></a>よくあるお問い合わせ</h2><p><span style="color:blue">Q</span>. B2B の機能以外で、Azure AD 間を連携することは可能ですか？</p>
<p><span style="color:red">A</span>. いいえ、できません。複数の Azure AD 間で同期や複製を行うことはできません。B2B の機能は Azure AD 同士を連携するというよりは、 Azure AD と別 Azure AD のユーザーを連携する機能です。</p>
<p><span style="color:blue">Q</span>. 別の Azure AD に登録されたアプリケーションを利用するのに、Azure AD B2B の機能を利用できますか？</p>
<p><span style="color:red">A</span>. はい、B2B の機能で要件を満たせます。Azure AD B2B の機能で別の Azure AD のユーザーを追加することで、そのユーザーは Azure AD 上のアプリケーションを利用することが可能です。</p>
<p><span style="color:blue">Q</span>. 旧ポータル(クラシックポータル)のように、個人アカウント(Microsoft アカウント)を明示的に指定して追加することはできますか？</p>
<p><span style="color:red">A</span>. いいえ、できません。ただし、 ユーザーのドメイン名が live.com、 hotmail.com、 gmail.com のようなコンシューマー向けのフリーアドレスを利用している場合にはマイクロソフト アカウントが招待されます。<br>それ以外では 個人アカウントを招待するのではなく、企業アカウントの招待が行われます。<br>そのため、招待対象のアカウントが個人アカウントであっても Azure ポータルから追加を試みた場合には組織アカウントが招待されます。</p>
<p>また、このときに組織アカウントとして該当のアカウントが存在していない場合には、組織アカウントのユーザー作成処理が試みられます。</p>
<h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>今回は、Azure AD B2B に関する概要について紹介しましたが、Azure AD B2B に関するトラブルや Azure AD B2B 完了後のトラブル、または招待メールを利用しない方法などの記事も必要に応じて参照ください。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/12/12/azure-active-directory/what-is-b2b/" data-id="cjtqwo5tq001ce4yt3q5twh5n" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD-B2B/">Azure AD B2B</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/RBAC/">RBAC</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory/powershell-module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/12/04/azure-active-directory/powershell-module/" class="article-date">
  <time datetime="2017-12-03T15:00:00.000Z" itemprop="datePublished">2017-12-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/12/04/azure-active-directory/powershell-module/">Azure Active Directory の PowerShell モジュール</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、 Azure ID チームの三浦です。今回は Azure Active Directory (Azure AD) の PowerShell モジュールの種類、インストール方法についてご案内します。</p>
<p>Azure AD への操作は主に Azure ポータル、 Office 365 ポータル、 Graph API それに今回紹介します PowerShell からおこなうことができます。PowerShell モジュールについても複数ありますので、その種類をまず紹介します。</p>
<h2 id="Azure-AD-PowerShell-の種類"><a href="#Azure-AD-PowerShell-の種類" class="headerlink" title="Azure AD PowerShell の種類"></a>Azure AD PowerShell の種類</h2><p>Azure AD の PowerShell には次のようなものがあります。</p>
<h3 id="1-MSOnline-Azure-AD-v1"><a href="#1-MSOnline-Azure-AD-v1" class="headerlink" title="1. MSOnline (Azure AD v1)"></a>1. MSOnline (Azure AD v1)</h3><p>Office 365 をご利用いただいている方にとっては Office 365 のライセンスを割り当てるときにも利用しますので馴染み深いかもしれません。当初からあるもので、あとから紹介する Azure AD v2 と明示的に区別する際に Azure AD v1 モジュールとも呼びます。Connect-Msolservice のようにコマンドレットに “Msol” という文字列が含まれています。現状でも Azure AD に対する PowerShell コマンドでよく使われています。</p>
<h3 id="2-Azure-AD-for-Graph-Azure-AD-v2"><a href="#2-Azure-AD-for-Graph-Azure-AD-v2" class="headerlink" title="2. Azure AD for Graph (Azure AD v2)"></a>2. Azure AD for Graph (Azure AD v2)</h3><p>当初は Azure AD は Office 365 の認証基盤という意味合いが大きかったのですが、 Azure AD に新しい機能が追加されることに伴い Azure AD  PowerShell の機能を拡張させていく必要がでてきました。その対応のために従来の MSOnline を拡張するのではなく、別途異なるモジュールを開発するというアプローチを取ることになり Azure AD for Graph (Azure AD v2 と言うほうが一般的なので以降は Azure AD v2 とします) というモジュールが作成されました。基本的には MSOnline で提供していた機能は Azure AD v2 でも提供されます。例えばユーザー作成をおこなうときに MSOnline モジュールでは <a href="https://docs.microsoft.com/en-us/powershell/module/msonline/new-msoluser?view=azureadps-1.0" target="_blank" rel="noopener">New-Msoluser</a> というコマンドを使いますが、Azure AD v2 では <a href="https://docs.microsoft.com/ja-jp/powershell/azure/active-directory/new-user-sample?view=azureadps-2.0" target="_blank" rel="noopener">New-AzureADUser</a> を利用します。基本的に MSOL コマンドレットの拡張は予定されていないため、新しい機能などは Azure AD v2 のみで提供されます。というわけで今後は基本的に Azure AD v2 コマンドをご利用くださいと案内したいところなのですが、、、完全に MSOL コマンドで提供していたものをカバーしているわけではないため、残念なのですが (大変申し訳ないのですが)、従来の MSOL コマンドも併用していく必要があります。</p>
<h3 id="3-Azure-AD-for-Graph-preview-Azure-AD-v2-preview"><a href="#3-Azure-AD-for-Graph-preview-Azure-AD-v2-preview" class="headerlink" title="3. Azure AD for Graph preview (Azure AD v2 preview)"></a>3. Azure AD for Graph preview (Azure AD v2 preview)</h3><p>Azure AD v2 モジュールはかなり早いスピードで新しいコマンドが追加されています。なるべく早く新しいモジュールを提供できるようプレビュー版も用意しています。プレビュー版については実際の運用環境での利用は推奨していませんが、Public Preview 中の機能を利用するためにはプレビュー版を利用する必要があることが多くあります。また、 Azure AD v2 の通常版 = General Availability 版がすでにインストールされている環境で通常版とプレビュー版を併用することはできません。 Preview 版を利用したい場合には、先に通常版を Uninstall-Module コマンドでアンインストールしたうえでプレビュー版をインストールをします。</p>
<h2 id="インストール方法について"><a href="#インストール方法について" class="headerlink" title="インストール方法について"></a>インストール方法について</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>MSOnline (Azure AD v1) と Azure AD v2 では前提となる .net Framework のバージョンが厳密には異なり、 MSOnline の場合には必ずしも必要にはならないのですが、古いものを利用していると問題が生じることがあるので、 Azure AD v1、 v2 を問わず、以下の前提条件を満たすようにしてください。なお、 Windows 10 / Windows Server 2016 は .NET Framework、 PowerShell の要件を既定で満たしていますので前提条件については考慮不要です。</p>
<ul>
<li>.NET Framework: バージョン 4.5.2 以降 (*1)</li>
<li>PowerShell: バージョン 5.0 以降 (*1)</li>
<li>OS: Windows 7 SP1 (*2)、 Windows Server 2008 R2 以降</li>
</ul>
<blockquote>
<ol>
<li>.NET Framework および PowerShell のバージョンについては、厳密に言うとこれを満たしていなくても動作するバージョンもありますが、古いバージョンだと問題が生じることがあるため上記を満たすようにします。</li>
<li>クライアント OS で利用する場合には 32 bit 環境ではなく 64 bit 環境の必要があります。</li>
</ol>
</blockquote>
<p>.NET Framework と PowerShell のインストール方法、現在インストールされているバージョンの確認方法は次の通りです。</p>
<h3 id="NET-Framework"><a href="#NET-Framework" class="headerlink" title=".NET Framework"></a>.NET Framework</h3><p>以下のサイトから .NET Framework 4.6 をインストールします。</p>
<p>Microsoft .NET Framework 4.6<br><a href="https://www.microsoft.com/ja-jp/download/details.aspx?id=48137" target="_blank" rel="noopener">https://www.microsoft.com/ja-jp/download/details.aspx?id=48137</a></p>
<p>インストールを試みたときにすでにインストールされているという旨のメッセージが表示された場合にはすでにインストールされていますので不要です。実際にインストール ウィザードを実行していなくとも .NET Framework でどのバージョンがインストールされているかは、 PowerShell のウィンドウを開き、次のコマンドを実行することで確認できます。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ChildItem</span> <span class="string">'HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP'</span> -recurse | <span class="built_in">Get-ItemProperty</span> -name Version,Release -EA <span class="number">0</span> | Where &#123; <span class="variable">$_</span>.PSChildName <span class="nomarkup">-match</span> <span class="string">'^(?!S)\p&#123;L&#125;'</span>&#125; | Select PSChildName, Version, Release</span><br></pre></td></tr></table></figure>
<p>以下の例では 4.7.02046 という新しいバージョンがインストールされていることが確認できます (4.7 のバージョンは OS によっては追加のモジュールのインストールが必要なのでここでは 4.6 の紹介にしていますが、もちろん 4.7 のインストールで構いません)。</p>

<h3 id="PowerShell-モジュール"><a href="#PowerShell-モジュール" class="headerlink" title="PowerShell モジュール"></a>PowerShell モジュール</h3><p>PowerShell のバージョンを 5.0 以上にするために Windows Management Framework (WMF) 5.1 を以下のサイトからダウンロードしてインストールします。</p>
<p>Windows Management Framework 5.1<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=54616</a></p>
<p>システムの PowerShell のバージョンは $psversiontable で確認できます。以下の例だと 5.1.15063.726 というバージョンがインストールされていることが確認できます。</p>
<img src="/blog/2017/12/04/azure-active-directory/powershell-module/powershell-version.jpg">
<h3 id="Azure-AD-PowerShell-インストール方法"><a href="#Azure-AD-PowerShell-インストール方法" class="headerlink" title="Azure AD PowerShell インストール方法"></a>Azure AD PowerShell インストール方法</h3><p>上記の前提条件を満たしたうえで、次の手順でインストールを実施します。</p>
<ol>
<li>管理者で PowerShell を起動します。</li>
<li><p>下記のコマンドを実行し、モジュールをダウンロードし、インストールします。</p>
<p> MSOnline (Azure AD v1):</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module -Name MSOnline</span><br></pre></td></tr></table></figure>
<p> Azure AD for Graph (Azure AD v2):</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module -Name AzureAD</span><br></pre></td></tr></table></figure>
<p> Azure AD for Graph preview (Azure AD v2 preview):</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module -Name AzureADPreview</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>Azure AD v2 と Azure AD v2 preview の両方を同じコンピューターにインストールできませんのでご注意ください。Azure AD Preview が必要にも関わらず Install-Module -Name AzureAD を実行してインストールした場合には、一度 Uninstall-Module -Name AzureAD を実行してアンインストールの上で Install-Module -Name AzureADPreview を実行します。</p>
</blockquote>
<blockquote>
<p>NuGet プロバイダーが必要というメッセージが表示された場合には Y をクリックして進めます。信頼されていないレポジトリのメッセージが表示された場合にも Y をクリックして進めます。それぞれの次のようなメッセージが表示されます。</p>
</blockquote>
<p>NuGet のメッセージ:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NuGet provider is required to <span class="keyword">continue</span></span><br><span class="line">PowerShellGet requires NuGet provider version <span class="string">'2.8.5.201'</span> or newer to interact with NuGet-based repositories. The NuGet</span><br><span class="line">provider must be available <span class="keyword">in</span> <span class="string">'C:\Program Files\PackageManagement\ProviderAssemblies'</span> or</span><br><span class="line"><span class="string">'C:\Users\taguiadmin\AppData\Local\PackageManagement\ProviderAssemblies'</span>. You can also install the NuGet provider by</span><br><span class="line">running <span class="string">'Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force'</span>. <span class="keyword">Do</span> you want PowerShellGet to install</span><br><span class="line">and import the NuGet provider now?</span><br><span class="line">[Y] Yes  [N] No  [S] Suspend  [?] Help (default is <span class="string">"Y"</span>):</span><br></pre></td></tr></table></figure>
<p>レポジトリのメッセージ:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Untrusted repository</span><br><span class="line">You are installing the modules from an untrusted repository. <span class="keyword">If</span> you trust this repository, change its</span><br><span class="line">InstallationPolicy value by running the Set-PSRepository cmdlet. Are you sure you want to install the modules from</span><br><span class="line"><span class="string">'PSGallery'</span>?</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is <span class="string">"N"</span>):</span><br></pre></td></tr></table></figure>
<blockquote>
<p>明示的にバージョン番号を指定する場合にはコマンドに -RequiredVersion 2.0.0.137 というように引数としてバージョン情報を追加します。</p>
</blockquote>
<blockquote>
<p>MSOnline については以前は Connect サイトからインストールパッケージをダウンロードできましたが、サイトのリタイアに伴いダウンロード パッケージは提供されなくなりました。Install-Module コマンドを実行することでインストールします。</p>
</blockquote>
<h2 id="補足事項"><a href="#補足事項" class="headerlink" title="補足事項"></a>補足事項</h2><p>&lt;別端末で保存したファイルを利用したい場合&gt;</p>
<p>何らかの理由で直接 Install-Module を実行してのインストールができないケースが稀にあります (ウイルス対策ソフトの影響等)。この場合には、他の端末で必要なモジュールを取得し、入手したファイルを元に Import-Module を実行する方法もあります (あまり多くの実績があるものではないため、基本は Install-Module での対応をお勧めします)。以下は Azure AD for Graph の例です。</p>
<ol>
<li>管理者として PowerShell を起動します。</li>
<li><p>下記のコマンドレットを実行し、リポジトリ ファイル群をダウンロードします。</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Save-Module -Name AzureAD -Path C:\temp\</span><br></pre></td></tr></table></figure>
<blockquote>
<p>C:\temp\ は保存先フォルダの指定となりますので、任意の存在するパス/フォルダをご指定ください。</p>
</blockquote>
</li>
<li><p>指定したフォルダ配下の \AzureAD\&lt;バージョン番号&gt;\ フォルダ配下に、リポジトリ ファイル群が展開されたことを確認します。</p>
</li>
<li><p>実際に Azure AD の PowerShell コマンドを利用したい端末の C:\Program Files\WindowsPowerShell\Modules フォルダに 2 でダウンロードしたフォルダ (今回の例の場合 c:\temp 配下の AzureAD フォルダ) をコピーします。</p>
</li>
<li><p>C:\Program Files\WindowsPowerShell\Modules フォルダに保存されたモジュールは PowerShell で自動的にロードされるため、そのまま実行ができるはずですが、コマンドがエラーになる場合には、以下を実行したうえで Connect-AzureAD  などを実行します。</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> C:\Program Files\WindowsPowerShell\Modules\AzureAD\&lt;バージョン番号&gt;\AzureAD.psd1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&lt;認証プロキシが存在する場合の注意事項&gt;</p>
<p>インターネットにアクセスする際に認証が必要なプロキシが存在するようなネットワーク環境では、 PowerShell 起動時に以下のコマンドを実行し、認証が必要なプロキシを経由してアクセスができるようにします。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ProxyCredential</span> = <span class="built_in">New-Object</span> System.Net.NetworkCredential(<span class="string">"ユーザー名"</span>,<span class="string">"パスワード"</span>)</span><br><span class="line">[System.Net.WebRequest]::DefaultWebProxy.Credentials = <span class="variable">$ProxyCredential</span></span><br></pre></td></tr></table></figure>
<p>&lt;モジュールがインストールされているかの確認&gt;</p>
<p>モジュールがインストールされているかは Get-InstalledModule コマンドで確認できます。</p>
<img src="/blog/2017/12/04/azure-active-directory/powershell-module/get-installedmodule.jpg">
<p>&lt;モジュールのアンインストール方法&gt;</p>
<p>Uninstall-Module コマンドでアンインストールができます。Azure AD v2 の通常版と Preview 版は併用できませんので、通常版を利用している環境で Preview 版を利用したい場合には管理者で PowerShell を起動し、 Preview 版をインストール前に次のコマンドで通常版のアンインストールが必要です。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uninstall-Module AzureAD</span><br></pre></td></tr></table></figure>
<p>以上です。最後に参考資料をご紹介します。</p>
<h2 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h2><p>Azure Active Directory PowerShell for Graph<br><a href="https://docs.microsoft.com/ja-jp/powershell/azure/active-directory/install-adv2?view=azureadps-2.0" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/powershell/azure/active-directory/install-adv2?view=azureadps-2.0</a></p>
<p>Azure​AD (Azure AD v2 コマンド一覧)<br><a href="https://docs.microsoft.com/en-us/powershell/azuread/v2/azureactivedirectory" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/powershell/azuread/v2/azureactivedirectory</a></p>
<p>AzureAD PowerShell’s Profile (Azure AD PowerShell 最新版リスト。 V1、 V2、 V2Preview)<br><a href="https://www.powershellgallery.com/profiles/AzureADPowerShell/" target="_blank" rel="noopener">https://www.powershellgallery.com/profiles/AzureADPowerShell/</a></p>
<h2 id="変更履歴"><a href="#変更履歴" class="headerlink" title="変更履歴"></a>変更履歴</h2><ul>
<li>2017/12/04: 公開しました。</li>
<li>2017/12/20: 前提条件について追記を行いました。</li>
<li>2018/01/31: Microsoft Connect のリタイアに伴い MSOnline モジュールのダウンロードができなくなったため追記しました。また、インストール時の手順として Save-Module は必要がありませんが、補足事項として別項を追加しました。</li>
<li>2018/02/08: Windows 10/2016 では前提条件を既定で満たしていることを追記しました。モジュールインストール時に表示される可能性があるメッセージを掲載しました。TLS 1.2 への対応などを考慮すると 4.6 のほうが望ましいため .NET Framework のダウンロードリンクを 4.6 のものに変更しました。</li>
<li>2018/05/10: モジュールがインストールされているかの確認方法とアンインストール コマンドを追記しました。</li>
<li>2018/07/13: Windows Management Framework 5.0 のリンクを 5.1 に変更しました。</li>
<li>2018/08/07: Save-Module で別端末でダウンロードしたモジュールを利用する際の手順を更新しました。</li>
<li>2018/10/17: Windows Management Framework (WMF) のサポート対象が 5.1 であることから .NET Framework の前提条件を WMF 5.1 インストールに必要となる 4.5.2 に変更しました。</li>
<li>2019/01/23: Azure AD v2 と Azure AD v2 preview が同時インストールできない注意書きをインストールの項目にも追記しました。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/12/04/azure-active-directory/powershell-module/" data-id="cjtqwo5x8003fe4yt0992mh8q" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/PowerShell/">PowerShell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory/qanda-conditional-access" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/12/04/azure-active-directory/qanda-conditional-access/" class="article-date">
  <time datetime="2017-12-03T15:00:00.000Z" itemprop="datePublished">2017-12-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/12/04/azure-active-directory/qanda-conditional-access/">Azure AD の条件付きアクセスに関する Q&amp;A</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの高田です。</p>
<p>今回はお問い合わせをよくいただく、Azure AD の条件付きアクセスについてです。</p>
<p>お問い合わせの多いご質問について、Q&amp;A 形式でおまとめいたしました。既存のドキュメントではカバーされていない動作や質問について今後も適宜内容を拡充していきますので、ご参照いただければと思います。</p>
<hr>
<p><span style="color:blue">Q</span>. Office 365 を利用しているが、条件付きアクセスを利用できますか？</p>
<p><span style="color:red">A</span>. はい、利用可能です。Office 365 をご利用いただいているお客様は、認証基盤として Azure AD をご利用いただいている状態となります。そのため、追加で Azure AD Premium のライセンスを購入いただくことで、利用可能になります。</p>
<hr>
<p><span style="color:blue">Q</span>. Azure AD Application Proxy を利用して公開しているアプリケーションなども条件付きアクセスで制御可能でしょうか。</p>
<p><span style="color:red">A</span>. はい、条件付きアクセスで制御可能です。Azure AD 上に登録されているアプリケーションであれば、条件付きアクセスで制御できます。Azure AD Application Proxy を利用して公開しているアプリケーションやご自身で開発し Azure AD 上に登録したアプリケーションも制御対象とすることが可能です。</p>
<hr>
<p><span style="color:blue">Q</span>. Azure AD B2B コラボレーション機能により招待されたゲスト ユーザーに対して条件付きアクセスのルールを適用する場合には、Azure AD Premium のライセンスを購入する必要があるのでしょうか。</p>
<p><span style="color:red">A</span>. いいえ、テナントに割り当てられている Azure AD Premium ライセンス数の 5 倍までのアカウントであれば、ゲスト ユーザーに対して条件付きアクセスを含む Azure AD Premium の機能を利用させることが可能です。詳細は下記公開情報を参照ください。</p>
<p>Azure Active Directory B2B コラボレーションのライセンスに関するガイダンス<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-licensing" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-licensing</a></p>
<hr>
<p><span style="color:blue">Q</span>. Azure AD Premium のライセンスを対象人数分購入すれば、該当ユーザーに割り当てる必要はないでしょうか。</p>
<p><span style="color:red">A</span>. いいえ、要件として人数分購入いただくだけでなく、ユーザーに対して割り当てる必要がございます。</p>
<hr>
<p><span style="color:blue">Q</span>. 条件付きアクセスを利用するためには、Azure AD Premium のライセンス数を何個購入すればよいでしょうか？</p>
<p><span style="color:red">A</span>. 条件付きアクセスの機能を利用してアプリケーションへのアクセス可否の評価が行われるユーザーに対して、Azure AD Premium (P1 以上) を割り当てる必要があります。現時点の実装では、Azure AD Premium ライセンスを割り当てていないユーザーであっても、ポリシーの対象であれば条件付きアクセス ポリシーの内容に従ってアクセス制限が行われますが、このような状態での利用はライセンス違反となります。</p>
<hr>
<p><span style="color:blue">Q</span>. 条件付きアクセスのポリシーを複数作成し、適用の優先順位をつけることは可能でしょうか。</p>
<p><span style="color:red">A</span>. いいえ、優先順位を作成することはできません。条件付きアクセスではそれぞれのポリシーが独立しており、条件に合致したものが適用されます。各ポリシーで条件が重複しないように構成することを検討ください。</p>
<hr>
<p><span style="color:blue">Q</span>. Exchange Online に対して条件付きアクセスを設定したところ Office 365 ポータルに対しても条件付きアクセスが設定されてしまいました。これは想定される動作でしょうか？</p>
<p><span style="color:red">A</span>. はい、これは想定される動作です。 2017 年 8 月 24 日以降は Exchange Online または SharePoint Online を対象とした条件付きアクセスが Office 365 ポータルにも反映されます。詳細は英語での情報となりますが以下のリンクも参照ください。</p>
<p>An update to Azure AD Conditional Access for Office.com<br><a href="https://cloudblogs.microsoft.com/enterprisemobility/2017/08/04/an-update-to-azure-ad-conditional-access-for-office-com/" target="_blank" rel="noopener">https://cloudblogs.microsoft.com/enterprisemobility/2017/08/04/an-update-to-azure-ad-conditional-access-for-office-com/</a></p>
<hr>
<p><span style="color:blue">Q</span>. 条件付きアクセスの [場所] の条件にクライアントの IP アドレス範囲を入れましたが制御されません。どうしてでしょうか？</p>
<p><span style="color:red">A</span>. 条件付きアクセスの [場所] の条件では、組織が外部と通信する際のグローバル IP アドレス (Azure AD から見た送信元グローバル IP アドレス) を利用します。例えば、社内のクライアントがプライベート IP アドレスを保持しており、外部ネットワークと通信する際にはグローバル IP アドレスを持つゲートウェイを経由して Azure AD と通信する環境があるとします。この場合、Azure AD から見ると、送信元 IP アドレスはグローバル IP アドレスを持つゲートウェイとなります。このような時は、件付きアクセスの [場所] の条件には、ゲートウェイのグローバル IP アドレスを指定ください。</p>
<hr>
<p><span style="color:blue">Q</span>. 条件付きアクセスで、X-Forwarded-For HTTP ヘッダーを利用して、組織内のクライアントの送信元 IP アドレスを判断可能ですか？</p>
<p><span style="color:red">A</span>. いいえ、X-Forwarded-For HTTP ヘッダーを使用し、条件付きアクセスで組織内のクライアントの送信元 IP アドレスを判定することはできません。条件付きアクセスの [場所] の条件では、組織が外部と通信する際のゲートウェイが持つグローバル IP アドレス (Azure AD から見た送信元グローバル IP アドレス) が制御に利用されます。Azure AD には、このグローバル アドレスを場所として利用します。<br>X-Forwarded-For HTTP ヘッダーは HTTP ヘッダー フィールドの 1 つです。ロード バランサーなどでクライアントの送信元 IP アドレスが変換された場合でも、HTTP ヘッダーに接続元のクライアント IP アドレスの情報を付加することで、接続先サーバーが接続元クライアント IP アドレスを特定できるようにするために利用されます。しかしながら、この X-Forwarded-For HTTP ヘッダーで指定された情報は組織内の IP アドレスであり、場所を示すものではありません。このような理由から、現状 Azure AD では、組織が外部と通信する際のゲートウェイのグローバル IP アドレス (Azure AD から見た送信元グローバル IP アドレス) を制御に利用しています。</p>
<hr>
<p><span style="color:blue">Q</span>. クレームルールと条件付きアクセスは併用は可能ですか？</p>
<p><span style="color:red">A</span>. はい、技術的には可能です。AD FS を利用したフェデレーション環境であれば、クレーム ルールが判定された後、条件付きアクセスが動作します。クレーム ルールで認証が拒否された場合は、その後の条件付きアクセスの処理は動作しません。ただし、類似機能であるため運用の複雑さなどを考慮すると、どちらか一方の機能をメインでご利用いただくのがよいかと存じます。</p>
<hr>
<p><span style="color:blue">Q</span>. 条件付きアクセスの設定において、全てユーザーがアクセスできない設定になってしまいました。設定を解除可能でしょうか。</p>
<p><span style="color:red">A</span>. このような状況の場合は、残念ながらお客様側での解除はできません。そのため、設定の解除をご希望の場合は、お手数ですが弊社サポート サービスをご利用いただけますと幸いです。Azure ポータルにもアクセスができない状況と存じますので、ほかにお持ちのテナントからお問い合わせを発行ください。<br>サポート サービスをご利用いただくには、Azure ポータル上から、Azure Active Directory を選択し、[新しいサポート要求] を選択ください。以下のような画面からお問い合わせいただければと思います。</p>
<img src="/blog/2017/12/04/azure-active-directory/qanda-conditional-access/create-support-ticket-1.png">
<img src="/blog/2017/12/04/azure-active-directory/qanda-conditional-access/create-support-ticket-2.png">
<p>上記内容が少しでもお客様の参考となりますと幸いです。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/12/04/azure-active-directory/qanda-conditional-access/" data-id="cjtqwo5x8003ge4ytdwajxoy8" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Conditional-Access/">Conditional Access</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory/azuread-access-denied" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/11/20/azure-active-directory/azuread-access-denied/" class="article-date">
  <time datetime="2017-11-19T15:00:00.000Z" itemprop="datePublished">2017-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/11/20/azure-active-directory/azuread-access-denied/">「アクセス権がありません」のエラーについて</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの坂井です。</p>
<p>今回は Azure ポータル上で表示される Azure AD に関するエラーメッセージについて説明します。</p>
<p>Azure ポータル上で、[Azure Active Directory] を選択した際に、下記のエラーが表示される場合があります。</p>
<hr>
<p>アクセスが拒否されました</p>
<p>アクセス権がありません</p>
<p>このコンテンツへのアクセス権がないようです。アクセス権を得るには、所有者に連絡してください。</p>
<hr>
<p>画面は下記のような表示です。</p>
<img src="/blog/2017/11/20/azure-active-directory/azuread-access-denied/azuread-access-denied.png">
<p>こちらは、エラーメッセージの通りアクセスしようとしたユーザーの権限が不足している状況を示すエラーになります。</p>
<p>ここでいう、権限とはサブスクリプションの権限（RBAC で付与した所有者の権限など）とは異なる、Azure AD の権限となります。</p>
<p>サブスクリプションの管理者と Azure AD の管理者の説明については、下記のブログをご確認ください。</p>
<p>-参考情報</p>
<p><a href="./subscription-azure-ad-relationship.md">Azure サブスクリプションと Azure AD の管理者</a></p>
<p>詳細<br>下記、 [Azure AD 管理ポータルへのアクセスを制限する] が「はい」に設定されている場合は、Azure AD の管理者権限を持ったユーザーのみが [Azure Active Directory] を参照できるようになります。</p>
<p>こちらを「いいえ」に設定することで、一般のユーザーでも [Azure Active Directory] 配下の参照が可能になりますが、設計上「はい」にする必要がある場合は、個別のユーザー毎に下記の回避策をご実施ください。</p>
<img src="/blog/2017/11/20/azure-active-directory/azuread-access-denied/azuread-portal.png">
<p>回避策<br>Azure AD ディレクトリの全体管理者の権限をもつユーザーで、Azure ポータル (<a href="https://portal.azure.com" target="_blank" rel="noopener">https://portal.azure.com</a>) へサインインします。<br>[Azure Active Directory] - [ユーザーとグループ] - [すべてのユーザー] - [（権限を付与する）ユーザー] の順に選択します。<br>[ディレクトリ ロール] をクリックします。<br>全体管理者 (または制限付き管理者) を選択して [保存] をクリックします。</p>
<p>管理者の種類と役割については、下記の弊社公開情報をご確認ください。</p>
<p>Azure Active Directory での管理者ロールの割り当て</p>
<p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-assign-admin-roles" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-assign-admin-roles</a></p>
<p>上記内容が少しでもお客様の参考となりますと幸いです。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/11/20/azure-active-directory/azuread-access-denied/" data-id="cjtqwo5ss000ie4ytx8aud77s" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory-connect/duplicate-attribute-recoverability-behavior" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/" class="article-date">
  <time datetime="2017-11-07T15:00:00.000Z" itemprop="datePublished">2017-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/">\[Azure AD Connect\] ID 同期と重複属性の回復性の動作について</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの後藤です。<br><br>2017 年 3 月に多くのテナントで有効化された ID 同期と重複属性の回復性の動作についてご紹介します。<br><br>なお、2017 年 10 月 30 日以降は例外なくすべてのテナントでこの機能は有効になっています。</p>
<p>以下のような流れでご紹介します。</p>
<p>&lt;目次&gt;</p>
<ol>
<li>以前の動作の概要</li>
<li>ID 同期と重複属性の回復性の動作</li>
<li>重複状態からの解消について</li>
<li>ID 同期と重複属性の回復性が動作しないケース</li>
</ol>
<h2 id="1-以前の動作の概要"><a href="#1-以前の動作の概要" class="headerlink" title="1. 以前の動作の概要"></a>1. 以前の動作の概要</h2><p>以前は、ディレクトリ同期の際に UPN または ProxyAddresses の属性が Azure AD 内で重複するようなユーザー オブジェクトを Azure AD に同期を試みた場合、エラーが発生し、ユーザー オブジェクトを Azure AD に作成することができませんでした。</p>
<p>一例 :<br>Azure AD に、UPN : <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> (オリジナルuser01)のユーザーが存在します。<br><br>この <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> ユーザーは、過去にディレクトリ同期によって登録されたユーザーですが、現在は一度ディレクトリ同期運用をやめており、テナントのディレクトリ同期も無効化しています。<br><br>この状態で、オンプレミス AD ドメインに UPN : <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> (新user01)のユーザーを作成します。<br><br>改めてディレクトリ同期を行う運用になったので、Azure AD Connect で同じテナントに同期を行うと、オリジナルuser01と新user01の UPN 重複エラーが発生し、Azure AD へのエクスポートに失敗します。</p>
<p>同じ UPN を持つユーザーであれば UPN ソフトマッチにより [重複ではなく結合] するのでは？と思われる方もいらっしゃるかもしれませんが、オリジナルuser01は [過去にディレクトリ同期で登録されたユーザー] であるため、ImmutableID がすでにセットされています。<br><br>そのため、この例ではソフトマッチは行われず、オリジナルuser01と新user01が別のオブジェクトとして扱われ、UPN 値の重複が問題となります。<br><br>なお、ProxyAddresses 属性のメール アドレス (プライマリ,セカンダリ共に) も UPN と同様に重複が問題となります。</p>
<p>このエラーを検知した場合、下記のような内容のメールで技術的通知の連絡先に通知されます。</p>
<ul>
<li>“Unable to update this object because the following attributes associated with this object have values that may already be associated with another object in your local directory services: [<a href="mailto:**UserPrincipalName**user01@contoso.com" target="_blank" rel="noopener">**UserPrincipalName**user01@contoso.com</a>;]. Correct or remove the duplicate values in your local directory.”<br>(このオブジェクトに紐づく属性値 [<strong>UserPrincipalName</strong> <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;] は、ローカル ディレクトリ サービスの他のオブジェクトに既に紐付けられているため、このオブジェクトを更新できません。ローカル ディレクトリの重複している属性値を変更または削除してください。)</li>
<li>Unable to update this object because the following attributes associated with this object have values that may already be associated with another object in your local directory services: [<strong>ProxyAddresses</strong>SMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;]. Correct or remove the duplicate values in your local directory.”<br>(このオブジェクトに紐づく属性値 [<strong>ProxyAddresses</strong> SMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;] は、ローカル ディレクトリ サービスの他のオブジェクトに既に紐付けられているため、このオブジェクトを更新できません。ローカル ディレクトリの重複している属性値を変更または削除してください。)</li>
</ul>
<p>以降、重複した属性値の状態を解消する対処を実施するまでは、定期的な同期処理が行われる毎に失敗し、このメールが通知されます。<br><br>重複属性の回復性が有効になるまでは！</p>
<h2 id="2-ID-同期と重複属性の回復性の動作"><a href="#2-ID-同期と重複属性の回復性の動作" class="headerlink" title="2. ID 同期と重複属性の回復性の動作"></a>2. ID 同期と重複属性の回復性の動作</h2><p>前述の例のように、ディレクトリ同期の際に UPN または ProxyAddresses の属性が Azure AD にて重複するようなユーザー オブジェクトを Azure AD に同期しようとしても、重複属性の回復性が有効なテナントでは、Export 処理時のエラーが出力されることなく、ユーザー オブジェクトが Azure AD に作成されます。<br><br>もちろん、値が重複した2つのオブジェクトを登録することはできないため、後から同期により生成されるユーザーのプレフィックス部分には 4 桁の数字がつき、サフィックス部分にはイニシャル ドメイン名が付与されます。</p>
<p>一例 :</p>
<ul>
<li>Azure AD に、UPN : <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> (オリジナルuser01)のユーザーが存在します。</li>
<li>この <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> ユーザーは、過去にディレクトリ同期によって登録されたユーザーですが、現在は一度ディレクトリ同期運用をやめており、テナントのディレクトリ同期も無効化しています。</li>
<li>この状態で、オンプレミス AD ドメインに UPN : <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> (新user01)のユーザーを作成します。</li>
<li>改めてディレクトリ同期を行う運用になったので、Azure AD Connect で同じテナントに同期を行うと、オリジナルuser01と新user01の UPN 重複状態が検知されます。</li>
<li>ここで重複属性の回復性の機能により、新user01がAzure AD に同期されると UPN : <a href="mailto:user012457@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012457@contoso.onmicrosoft.com</a> のユーザーが同期により作成されます。<br>(2457 の4桁の数字はランダムです)</li>
</ul>
<p>この重複属性の回復性に該当する同期を検知した場合、下記のような内容のメールで技術的通知の連絡先に通知されます。</p>
<ul>
<li><p>このオブジェクトは Azure Active Directory で更新されましたが、次の属性が他のオブジェクト [UserPrincipalName <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;] と関連付けられているため、一部のプロパティが変更されています。この問題を解決する手順に関しては、<a href="https://aka.ms/duplicateattributeresiliency" target="_blank" rel="noopener">https://aka.ms/duplicateattributeresiliency</a> をご覧ください。</p>
</li>
<li><p>このオブジェクトは Azure Active Directory で更新されましたが、次の属性が他のオブジェクト [ProxyAddresses SMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;] と関連付けられているため、一部のプロパティが変更されています。この問題を解決する手順に関しては、<a href="https://aka.ms/duplicateattributeresiliency" target="_blank" rel="noopener">https://aka.ms/duplicateattributeresiliency</a> をご覧ください。</p>
</li>
</ul>
<p>このメールは検知された初回のみ送信され、以降繰り返される同期のタイミングでは送信されません。<br><br>そのため、後から重複対象のオブジェクトをメールの履歴のみで探すのが困難になることが予想されますが、ご安心ください。<br><br>PowerShell コマンドで重複する属性の競合のエラー状況を DirSyncProvisioningErrors から確認できます。</p>
<p>例 :<br>Get-MsolDirSyncProvisioningError -ErrorCategory PropertyConflict</p>
<p>ExtensionData      : System.Runtime.Serialization.ExtensionDataObject<br>DisplayName        : user01<br>ImmutableId        : EVxRjF4MDACb9TViLrGGvA==<br>LastDirSyncTime    : 2017/10/20 5:02:43<br>ObjectId           : 87d11ec2-e8ce-4a99-801a-6352d5678a03<br>ObjectType         : User<br>ProvisioningErrors : {ProxyAddresses, UserPrincipalName}<br>ProxyAddresses     : {smtp:<a href="mailto:user01@contoso.onmicrosoft.com" target="_blank" rel="noopener">user01@contoso.onmicrosoft.com</a>, smtp: <a href="mailto:user012457@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012457@contoso.onmicrosoft.com</a>}<br>UserPrincipalName  : <a href="mailto:user012457@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012457@contoso.onmicrosoft.com</a></p>
<p>以上は UserPrincipalName が重複する場合の動作ですが ProxyAddresses の値が重複する場合には重複した情報は削除されます。例えば UserPrincpalName と ProxyAddresses の両方が重複している場合には、ディレクトリ同期の結果 UserPricipalName は “+<4digitnumber>@.onmicrosoft.com”　になり、 ProxyAddresses は null となります。</4digitnumber></p>
<h2 id="3-重複状態からの解消について"><a href="#3-重複状態からの解消について" class="headerlink" title="3. 重複状態からの解消について"></a>3. 重複状態からの解消について</h2><p>約一時間に一度のバック グラウンドのタイマー タスクが Azure プラットフォームで動作しており重複が解消されているか確認します。重複属性を持つユーザーの削除、重複属性の値の修正により、重複している属性の値の重複が解消されると、DirSyncProvisioningErrors を消す動作と UPN 及び ProxyAddresses に格納されている “+&lt;<em>4DigitNumber&gt;@.onmicrosoft.com</em>”　の値をオンプレミス AD から元々エクスポートしようとしていた UPN 及び ProxyAddresses に格納されている値に自動的に修正する動作が生じます。<br><br>経験則にはなりますが、重複が解消されてから DirSyncProvisioningErrors を消す動作と UPN 及び ProxyAddresses の自動解決には早い場合には 1.5 時間、時間を要する場合では 24 時間ほどかかります。</p>
<p>例 :<br>(1) Azure AD 上のオリジナルuser01 である <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> というユーザーが削除され、新user01との UPN の重複が解消されます。<br>(2) Azure 側で約1時間に1回行われているバックグラウンドのタイマー タスクで重複が解消されことを検知します。<br>(3) 新user01オブジェクトに対する DirSyncProvisioningErrors が消え、Azure AD に存在する UPN が <a href="mailto:user012457@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012457@contoso.onmicrosoft.com</a>のユーザーの UPN が <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> に自動変更されます。</p>
<h2 id="4-ID-同期と重複属性の回復性が動作しないケース"><a href="#4-ID-同期と重複属性の回復性が動作しないケース" class="headerlink" title="4. ID 同期と重複属性の回復性が動作しないケース"></a>4. ID 同期と重複属性の回復性が動作しないケース</h2><p>次のようなケースでは ID 同期と重複属性の回復性は動作しません。</p>
<p><strong>シナリオ1. オンプレミス Active Directory 上の UPN 名に含まれるドメイン名がAzure AD にはカスタムドメインとして登録されていない場合</strong></p>
<p>オンプレミス AD ドメイン上でのあるユーザーの UPN の値が <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> だとします。<br><br>この AD ドメインのディレクトリ同期先である Azure AD のイニシャル ドメインがonmicrosoft.com であり、カスタム ドメインとして contoso.com を登録していない環境であるとします。</p>
<p>この環境でディレクトリ同期を実施した結果 Azure AD に作成されるユーザーの UPN の値は、呼応するカスタム ドメインが存在しないので <a href="mailto:user01@contoso.onmicrosoft.com" target="_blank" rel="noopener">user01@contoso.onmicrosoft.com</a> というようになります。<br><br>また、この Azure AD に同期作成されたユーザーに対して属性が重複するユーザーを同期した場合 (前述の 1. 2. のような条件を満たしたケース) が生じた場合には、後から同期されたユーザーはこれまでのご案内と同様に <a href="mailto:user012547@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012547@contoso.onmicrosoft.com</a> というようになります。<br>しかし、この状況ではオリジナルの user01 が削除されるなど、重複状態が解消されても、<a href="mailto:user012547@contoso.onmicrosoft.com" target="_blank" rel="noopener">user012547@contoso.onmicrosoft.com</a> ユーザーの自動　UPN 変更回復は実行されません。</p>
<p><strong>シナリオ2. SipProxyAddress の値が重複する場合 :</strong></p>
<p>ProxyAddress 属性に SIP: として指定する SipProxyAddress 値は、Azure AD ユーザーに同期されると SipProxyAddress属性にセットされます。<br><br>この SipProxyAddress は前述の 1. や2. のような条件で重複するケースの場合は、重複属性の回復性は動作せず、“+<4digitnumber>@.onmicrosoft.com” のユーザーが Azure AD に作成されることもありません。<br><br>これは、今回の重複属性の回復性の発動対象の値が Azure AD 側のユーザーが保持する UPN と ProxyAddresses のみとなり、SipProxyAddress の重複は発動対象ではないことが原因です。以下で詳細を解説します。</4digitnumber></p>
<p>SipProxyAddress とは、下記一例にあるコマンドで確認することができる属性です。</p>
<p>一例 :</p>
<ol>
<li><p>Connect-AzureAD コマンドで Azure AD にサインインします。</p>
<img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/2-1.png">
</li>
<li><p>Get-AzureADUser コマンドで対象ユーザーのオブジェクト ID を確認します。</p>
<img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/2-2-1.png">
<img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/2-2-2.png">
</li>
<li><p>Get-AzureADUser コマンドで対象ユーザーについてプロパティを確認します。</p>
<img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/2-3.png">
<img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/2-3-2.png">
</li>
</ol>
<p>オンプレミス AD のユーザーの ProxyAddresses に “SIP:“ より始まる Lync 及び Skype で利用するアドレスが値として格納されている場合に、ディレクトリ同期をすると Azure AD に生成されるユーザーの SipProxyAddress にこの値が格納されます。</p>
<p>具体的な例は次のとおりです。</p>
<ul>
<li>Azure AD に、SipProxyAddress 属性に <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> の値を持つユーザーが存在します(オリジナルuser01)。</li>
<li>このオリジナルuser01ユーザーは、過去にディレクトリ同期によって登録されたユーザーですが、現在は一度ディレクトリ同期運用をやめており、テナントのディレクトリ同期も無効化しています。</li>
<li>この状態で、オンプレミス AD ドメインに ProxyAddresses 属性内に [SIP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>] の値を持つユーザーを作成します(新user01)。</li>
<li>改めてディレクトリ同期を行う運用になったので、Azure AD Connect で同じテナントに同期を行うと、オリジナルuser01と新user01の SipProxyAddress 重複状態が検知されますが、重複属性の回復性機能の対象外であるため、単純に重複エラーとなり、Azure AD へのエクスポートが行われない結果となります。</li>
</ul>
<p>このエラーを検知した場合、下記のような内容のメールで技術的通知の連絡先に通知されます。<br><br>また、本メールは同期の処理が繰り返し行われ、都度エクスポートが失敗する度に通知されます。</p>
<ul>
<li>このオブジェクトを更新できません。このオブジェクトに関連付けられている次の属性の値が、ローカル ディレクトリ サービスの別のオブジェクトに既に関連付けられていることが原因として考えられます: [SipProxyAddress <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> ディレクトリで重複している値を修正または削除してください。属性値が重複しているオブジェクトの検出方法については、<a href="http://support.microsoft.com/kb/2647098" target="_blank" rel="noopener">http://support.microsoft.com/kb/2647098</a> を参照してください。</li>
</ul>
<p><strong>シナリオ3. 一度同期対象から外したユーザーを再度同期対象に戻した場合 :</strong><br>一度同期対象から外した後で、別のユーザーに同じ ProxyAddresses を設定し、同期します。同期対象から外したユーザーは、 Azure AD 上でも削除されますが、完全に削除されるのではなく 30 日間はごみ箱に保存されます。このゴミ箱にユーザー情報が残っていても、この場合には重複は検出されません。その上で、同期対象から外したユーザーを再度同期対象にします。このとき、別のユーザーではすでに ProxyAddresses に同じものが設定されているので重複が生じますが、重複属性の回復性機能が動作すれば、ユーザー自体の同期はされますが、 ProxyAddresses は空になると予測されますが、そうなりません。<br><br>わかりにくいと思いますので、具体例を紹介します。</p>
<ol>
<li><a href="mailto:User01@contoso.com" target="_blank" rel="noopener">User01@contoso.com</a> というユーザーは ProxyAddresses としてSMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> をもち、その情報が Azure AD に同期されています。</li>
<li><a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> を同期対象から解除します。この後で同期処理が行われることにより<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> は Azure AD 上はごみ箱に入ります。</li>
<li><a href="mailto:user02@contoso.com" target="_blank" rel="noopener">user02@contoso.com</a> “ をオンプレミス AD に作成し、ProxyAddresses として <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> を設定します。ディレクトリ同期をし、Azure AD にユーザーが生成されます。また、 ProxyAddresses <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> を持つ削除されておらず有効なアカウントは存在しないため、重複検出機能は動作せずにそのまま作成されます。</li>
<li><a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> を同期対象に戻します。その後、ディレクトリ同期をしますと、Azure AD のごみ箱にあります <a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a> を再度有効なユーザーアカウントに変更する処理が行われます。しかし、このとき ProxyAddresses が重複しているためエラーが発生しますが、このとき重複検出の回復性の機能は動作せずにユーザーは有効にされず、 Azure AD Connect としても同期のエラーを検出します。</li>
</ol>
<p>このシナリオに合致するケースでは、下記のようなエラーが記録されます。<br><img src="/blog/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/31.png"></p>
<p>このエラーを検知した場合も、下記のような内容のメールで技術的通知の連絡先に通知されます。</p>
<p>Unable to update this object because the following attributes associated with this object have values that may already be associated with another object in your local directory services: [<strong>ProxyAddresses</strong>SMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;]. Correct or remove the duplicate values in your local directory.”<br><br>(このオブジェクトに紐づく属性値 [<strong>ProxyAddresses</strong> SMTP:<a href="mailto:user01@contoso.com" target="_blank" rel="noopener">user01@contoso.com</a>;] は、ローカル ディレクトリ サービスの他のオブジェクトに既に紐付けられているため、このオブジェクトを更新できません。ローカル ディレクトリの重複している属性値を変更または削除してください。)</p>
<p>以降、重複した ProxyAddresses の値の状態を解消する対処を実施するまでは、定期的な同期処理が行われる毎に失敗し、このメールが通知されます。</p>
<p>「コミュニティにおけるマイクロソフト社員による発言やコメントは、マイクロソフトの正式な見解またはコメントではありません。」</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/11/08/azure-active-directory-connect/duplicate-attribute-recoverability-behavior/" data-id="cjtqwo5yd004qe4ytyx8jj79h" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory/subscription-azure-ad-relationship" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/11/04/azure-active-directory/subscription-azure-ad-relationship/" class="article-date">
  <time datetime="2017-11-03T15:00:00.000Z" itemprop="datePublished">2017-11-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/11/04/azure-active-directory/subscription-azure-ad-relationship/">Azure サブスクリプションと Azure AD の管理者</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、 Azure ID サポートチームの三浦です。</p>
<p>今回は混乱することが多い Azure のサブスクリプションと Azure Active Directory (Azure AD) の関係、それぞれの管理者について紹介します。</p>
<h2 id="Azure-サブスクリプションと-Azure-AD-の関係"><a href="#Azure-サブスクリプションと-Azure-AD-の関係" class="headerlink" title="Azure サブスクリプションと Azure AD の関係"></a>Azure サブスクリプションと Azure AD の関係</h2><p>まず、 Azure サブスクリプションと Azure AD の関係ですが、 Azure のサブスクリプションに Azure AD が含まれているというイメージを持たれている方もいるかもしれませんが、以下の図のようなイメージは間違いです。</p>
<img src="/blog/2017/11/04/azure-active-directory/subscription-azure-ad-relationship/wrong-understanding.png">
<p>正しくは Azure サブスクリプションと Azure AD には包含関係は無く、独立しています。Azure サブスクリプションは必ず 1 つの Azure AD に関連付けられています (*注1) ので、両者の関係性は次のような図になります。</p>
<img src="/blog/2017/11/04/azure-active-directory/subscription-azure-ad-relationship/subscription-relationship.png">
<p>上の図では 2 つのサブスクリプションが Office 365 を利用中の同一の Azure AD に関連づけられている例です。この例では Office 365 で利用しているアカウント情報を Azure のサブスクリプションも参照し、サブスクリプションへのアクセス権限の付与などにもそのまま利用します。</p>
<blockquote>
<p>注 1: 関連付けのことを “信頼しています” という表現を使用する場合もあります。この関連付けを変更するためには、サブスクリプションのアカウント管理者を別の Azure AD のユーザーに譲渡する作業、もしくはディレクトリの切り替えの作業が必要です。Azure AD に関連づけられた Azure のサブスクリプションは 1 つの場合もありますし、3 つ以上の場合もあります。また、 Office 365 を利用中の Azure AD に関連付けることもできれば、そうではないケースもあります。</p>
</blockquote>
<p>1 つの Azure サブスクリプションが複数の Azure AD を指定することはできません。Azure サブスクリプションが参照する Azure AD は必ず 1 つです。</p>
<h2 id="Azure-サブスクリプションの管理者"><a href="#Azure-サブスクリプションの管理者" class="headerlink" title="Azure サブスクリプションの管理者"></a>Azure サブスクリプションの管理者</h2><p>Azure サブスクリプションの管理者については Microsoft Azure の各種アカウント権限について にそれぞれ説明があります。少し補足するとAzure クラシック ポータル時代にはアカウント管理者、サービス管理者、共同管理者という 3 つの役割しかありませんでした。</p>
<p>現在の Azure 新ポータルでも、それぞれの管理者は有効ですが、それに加えてサブスクリプション単位ではなく、リソース毎に閲覧、あるいは編集が可能なユーザーを柔軟に設定できる仕組み (RBAC = Role Based Access Control ロールベースのアクセス制御 *注2) が設定できます。サブスクリプションに対して所有者というロールを割り当てれば、従来のクラシック ポータルでの共同管理者相当になります。この RBAC の設定では Azure サブスクリプションが関連付けられた Azure AD のアカウント情報が利用されます。</p>
<blockquote>
<p>注 2: Azure ポータルで RBAC の設定を行う場合には Access Control (IAM) からおこないます。 IAM は Identity and Access Management の略です。</p>
</blockquote>
<h2 id="Azure-AD-の管理者"><a href="#Azure-AD-の管理者" class="headerlink" title="Azure AD の管理者"></a>Azure AD の管理者</h2><p>Azure AD でも Azure サブスクリプションの場合と同様に様々な役割があり、その詳細は Azure Active Directory での管理者ロールの割り当て で確認できます。代表的なものとして全体管理者 (Global Administrator) がありますが、この役割をもつアカウントは Azure AD のディレクトリに対してすべての権限を持ちます。</p>
<p>なお、各 Azure AD ディレクトリ (テナント) は独立していますので、ある Azure AD で全体管理者になっていても別の Azure AD の全体管理者になるわけではありません。例えば company1com.onmicrosoft.com という Azure AD ディレクトリの全体管理者は company2com.onmicrosoft.com の全体管理者ではありません。ただ、 B2B の機能で company2com.onmicrosoft.com から招待を受け、更にこのディレクトリの全体管理者の権限の付与を受けることは可能です。</p>
<h2 id="Azure-サブスクリプションの管理者と-Azure-AD-の管理者"><a href="#Azure-サブスクリプションの管理者と-Azure-AD-の管理者" class="headerlink" title="Azure サブスクリプションの管理者と Azure AD の管理者"></a>Azure サブスクリプションの管理者と Azure AD の管理者</h2><p>Azure サブスクリプションと Azure AD はそれぞれ独立したものです。</p>
<p>管理者についてもそれぞれ独立していますので Azure サブスクリプションの管理者であっても Azure AD の全体管理者でなければ、 Azure AD の管理 (ユーザー追加、削除など) はできません。同様に Azure AD の全体管理者であっても、必ずしも紐づく Azure サブスクリプションの管理者ではありません。</p>
<p>例えば次のような関係を考えてみましょう。</p>
<p>company1 という会社ではすでに Azure AD を保持しており、その Azure AD のディレクトリ名は company1com.onmicrosoft.com です。この Azure AD にはカスタムドメインとして company1.com というドメイン名が紐づけられています (*注3)。以下の図では <a href="mailto:user1@company1.com" target="_blank" rel="noopener">user1@company1.com</a> というアカウントが Azure のサブスクリプションを作成した状態での関係を示しています。</p>
<img src="/blog/2017/11/04/azure-active-directory/subscription-azure-ad-relationship/subscription-relationship-a.png">
<p><a href="mailto:user1@company1.com" target="_blank" rel="noopener">user1@company1.com</a> というアカウントは Azure のサブスクリプションのアカウント管理者でありサービス管理者です。そのため、サブスクリプション内のすべての権限を持ちます。例えばこのサブスクリプション内で仮想マシンを作成したり、仮想ネットワークを設定したりすることができます。しかし、関連づけられている Azure AD に対しては user1 は管理者権限を持ちません。Azure AD に対して管理者権限を必要とする作業を実施する場合には <a href="mailto:admin1@company1com.onmicrosoft.com" target="_blank" rel="noopener">admin1@company1com.onmicrosoft.com</a> または <a href="mailto:admin2@company1.com" target="_blank" rel="noopener">admin2@company1.com</a> という全体管理者に、作業を依頼するか、あるいは自身に Azure AD の権限を与えてくれるように依頼する必要があります。</p>
<p>別のパターンを考えてみます。</p>
<img src="/blog/2017/11/04/azure-active-directory/subscription-azure-ad-relationship/subscription-relationship-b.png">
<p>ここでは Microsoft アカウントの <a href="mailto:user2@outlook.com" target="_blank" rel="noopener">user2@outlook.com</a> を指定して Azure サブスクリプションを作成しています。この例の outlook.com のように企業に紐づかない Microsoft アカウントを利用して Azure サブスクリプションを作成した場合など、サブスクリプション作成時に利用したアカウントが所属する Azure AD が無い場合には、新規で Azure AD ディレクトリが自動的に作成されます。この場合、特に役割の追加作業をしていなくても Azure サブスクリプションのアカウント管理者 = Azure AD の全体管理者になります。</p>
<p>この場合でも以下のようにサブスクリプションに別のアカウント <a href="mailto:user3@outlook.com" target="_blank" rel="noopener">user3@outlook.com</a> を所有者として追加した場合には、このアカウントは Azure AD の管理者ではありませんので、もしそのアカウントにも権限を付与したいのであれば <a href="mailto:user2@outlook.com" target="_blank" rel="noopener">user2@outlook.com</a> が、 <a href="mailto:user3@outlook.com" target="_blank" rel="noopener">user3@outlook.com</a> を全体管理者にする作業が必要です。</p>
<blockquote>
<p>注 3: Azure AD では必ず設定される xxxxx.onmicrosoft.com というドメイン名に加えてカスタムドメイン名を追加することができます。カスタムドメイン名を追加するためには、そのドメインに対して権限を持っている (ドメインのゾーンをインターネットで名前解決でき、そのゾーンを管理している) 必要があります。詳しくはこちらのサイトを参照ください。</p>
</blockquote>
<h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>今回は混乱しやすい Azure サブスクリプションと Azure AD の関係についてご紹介しました。いろいろな管理者が存在していますが、その管理者が Azure サブスクリプションの管理者なのか Azure AD の管理者なのかということを意識するとわかりやすくなると思います。</p>
<p>文中でも一部触れていますが、参考となる公開情報を紹介しまして、今回は以上とします。</p>
<p>Microsoft Azure の各種アカウント権限について<br><a href="https://blogs.msdn.microsoft.com/dsazurejp/2013/10/02/303/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/dsazurejp/2013/10/02/303/</a></p>
<p>Azure サブスクリプションを Azure Active Directory に関連付ける方法<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-how-subscriptions-associated-directory" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-how-subscriptions-associated-directory</a></p>
<p>Azure Active Directory での管理者ロールの割り当て<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-assign-admin-roles-azure-portal" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-assign-admin-roles-azure-portal</a></p>
<p>クイック スタート: カスタム ドメイン名を Azure Active Directory に追加する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/add-custom-domain" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/add-custom-domain</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/11/04/azure-active-directory/subscription-azure-ad-relationship/" data-id="cjtqwo5x9003ie4yte2cq96ss" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Subscription/">Subscription</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory-connect/general-information" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/10/24/azure-active-directory-connect/general-information/" class="article-date">
  <time datetime="2017-10-23T15:00:00.000Z" itemprop="datePublished">2017-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/10/24/azure-active-directory-connect/general-information/">Azure AD Connect サーバーの全般情報</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの後藤です。</p>
<p>今回は Azure AD Connect サーバー構成に関わる情報採取についてご紹介します。<br>Azure AD Connect に関わる問題のときに有効ですが、同期のトラブルでは “Azure AD Connect でユーザー同期ができない問題” の情報取得も合わせてお願いします。</p>
<p>&lt;採取情報&gt;</p>
<p>以下の情報を Azure AD Connect サーバー上で採取します。</p>
<ol>
<li>アプリケーション / システムのイベントログ</li>
<li>Azure AD Connectトレース ログ</li>
<li>Azure AD Connect の構成情報</li>
<li>Azure AD Connect のバージョン情報</li>
</ol>
<h2 id="1-アプリケーション-システムのイベントログ"><a href="#1-アプリケーション-システムのイベントログ" class="headerlink" title="1.アプリケーション / システムのイベントログ"></a>1.アプリケーション / システムのイベントログ</h2><ol>
<li>Azure AD Connect サーバーに管理者権限にてログインします。</li>
<li>コマンド プロンプトを実行します。</li>
<li><p>以下のコマンドを実行し、出力された .evtx ファイルを採取します。</p>
 <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil epl system C:\SystemEvent.evtx</span><br><span class="line">wevtutil epl Application C:\AppliEvent.evtx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="2-Azure-AD-Connect-トレース-ログ"><a href="#2-Azure-AD-Connect-トレース-ログ" class="headerlink" title="2.Azure AD Connect トレース ログ"></a>2.Azure AD Connect トレース ログ</h2><p>下記フォルダーおよびフォルダー配下のファイルを zip ファイルなどにまとめて保存します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c:\ProgramData\AADConnect</span><br><span class="line">%localappdata%\AADConnect</span><br></pre></td></tr></table></figure>
<p>例: c:\Users\admin001\AppData\Local\AADConnect</p>
<h2 id="3-Azure-AD-Connect-の構成情報"><a href="#3-Azure-AD-Connect-の構成情報" class="headerlink" title="3.Azure AD Connect の構成情報"></a>3.Azure AD Connect の構成情報</h2><p>PowerShell にて以下のコマンドレットを実行し、出力されたフォルダーおよびファイルを Zip ファイル等にまとめて保存します。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Get-ADSyncAutoUpgrade &gt; c:\ADSyncAutoUpgrade.txt</span><br><span class="line">(Get-ADSyncGlobalSettings).Parameters | select Name,Value &gt; c:\ADSyncGlobalSettings.txt</span><br><span class="line">Get-ADSyncScheduler &gt; c:\ADSyncScheduler.txt</span><br><span class="line">Get-ADSyncSchedulerConnectorOverride &gt; c:\ADSyncSchedulerConnectorOverride.txt</span><br><span class="line">Get-ADSyncServerConfiguration -Path c:\aadconnect</span><br></pre></td></tr></table></figure>
<h2 id="4-Azure-AD-Connect-のバージョン情報"><a href="#4-Azure-AD-Connect-のバージョン情報" class="headerlink" title="4.Azure AD Connect のバージョン情報"></a>4.Azure AD Connect のバージョン情報</h2><ol>
<li><p>コマンド プロンプトを管理者として起動して、以下のコマンドを実行します。</p>
 <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic product list &gt; product.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>カレント ディレクトリに product.txt として保存されます。</p>
</li>
</ol>
<p>ここでご案内しました情報を事前に取得し、お問い合わせと合わせてご提供いただくことで次のようなメリットがあります。</p>
<ol>
<li>お問い合わせに対する回答・問題解決をよりはやくできます。</li>
<li>後々、再現できなくなり、問題発生時の情報がないために、問題の発生要因を追及できなくなるケースが減らせます。</li>
<li>サポート エンジニアより情報採取を案内される分のやり取りを減らせます。</li>
<li>情報があるため、サポート エンジニアがより事象についてより把握した状態でお客様とゴール設定ができます。</li>
</ol>
<p>「コミュニティにおけるマイクロソフト社員による発言やコメントは、マイクロソフトの正式な見解またはコメントではありません。」</p>
<p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/10/24/azure-active-directory-connect/general-information/" data-id="cjtqwo5tv001je4yttulmiv97" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/サポート/">サポート</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/情報採取/">情報採取</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory-connect/problem-user-synchronize" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/10/24/azure-active-directory-connect/problem-user-synchronize/" class="article-date">
  <time datetime="2017-10-23T15:00:00.000Z" itemprop="datePublished">2017-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/10/24/azure-active-directory-connect/problem-user-synchronize/">Azure AD Connect でユーザー同期ができない問題</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームの後藤です。</p>
<p>今回は Azure AD Connect サーバーでユーザー同期に問題が生じているケースについて取得する情報をご紹介します。<br>なお、この情報は “ユーザー同期トラブル” に特化していますので、併せて別途紹介しています Azure AD Connect の全般情報の採取もお願いします。</p>
<p>&lt;採取情報&gt;<br>1.オンプレミス Active Directory に格納されるユーザー オブジェクト情報<br>2.Azure AD Connect サーバー上のユーザー オブジェクト情報<br>3.Synchronization Service Manager のエラー画面ショット<br>4.イベントログ<br>5.エラーログの出力結果</p>
<p>&lt;取得手順&gt;</p>
<h1 id="オンプレミス-Active-Directory-に格納されるユーザー-オブジェクト情報"><a href="#オンプレミス-Active-Directory-に格納されるユーザー-オブジェクト情報" class="headerlink" title="オンプレミス Active Directory に格納されるユーザー オブジェクト情報"></a>オンプレミス Active Directory に格納されるユーザー オブジェクト情報</h1><p>同期できないという問題が一部のオブジェクトで生じている場合には、正常に同期が完了しているユーザーと同期に問題が生じているものについて少なくとも 1 つずつを任意に選択の上、取得ください。</p>
<p>1-1. ドメイン コントローラーにて管理者権限でコマンド プロンプトを開きます。<br>1-2. 以下のコマンドをそれぞれのオブジェクトに対して実行します。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldifde.exe -f &lt;出力ファイル名&gt; -t <span class="number">3268</span> -d &lt;同期できないユーザーの DN 名&gt; -p subtree</span><br></pre></td></tr></table></figure>
<p>ユーザーの DN 名は、その対象がユーザーの場合であれば、コマンドで dsquery user -name &lt;ユーザー名&gt; で確認できます。</p>
<p>例えば contoso.com ドメインの OU1 という OU に所属している user1 というアカウントの場合には、 dsquery user -name user1 のコマンドの結果、次のように表示されます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;CN=user1,OU=OU1,DC=contoso,DC=com&quot;</span><br></pre></td></tr></table></figure>
<p>この場合に c:\user1_ad.txt に出力するコマンドは次のようになります。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldifde.exe -f c:\user1_ad.txt -t <span class="number">3268</span> -d "CN=user1,OU=OU1,DC=contoso,DC=com" -p subtree</span><br></pre></td></tr></table></figure>
<p>1-3. 出力されたファイルを保存します。</p>
<h1 id="2-Azure-AD-Connect-サーバー上のオブジェクト情報"><a href="#2-Azure-AD-Connect-サーバー上のオブジェクト情報" class="headerlink" title="2.Azure AD Connect サーバー上のオブジェクト情報"></a>2.Azure AD Connect サーバー上のオブジェクト情報</h1><ul>
<li>1 の手順で ldifde コマンドにて取得したオブジェクトと同オブジェクトについて採取します。</li>
</ul>
<p>2-1. 既定で “C:\Program Files\Microsoft Azure AD Sync\UIShell” にあります “miisclient.exe” を実行し、[Synchronization Service Manager] を開きます。<br><br>2-2. 画面上部の [Metaverse Search] ボタンを押します。<br><br>2-3. 画面上部の [Scope by Objects Type] から、[person]を選びます。<br><br>あまりにも多くのユーザーが [Search Results] として出力され、さらに細かい条件を指定する場合は、[Attribute] に属性を指定し、[Operator]に “Equal” や “Starts with(前方一致) “を選択し、[Value] に検索するユーザーのキーワードをご指定ください。<br><br>2-4. 表示された ユーザーをダブルクリックします。<br><br>2-5. [Metaverse Object Properties]の画面をひろげ、 [Attributes] タブの設定全体が見えるようにした上で画面キャプチャを取得します。（画面が切れる場合は、スクロールなどして全体の情報を採取します）<br><br>2-6. [Connectors]タブを選択します。<br><br>2-7. [Distinguished Name] にAzure AD とオンプレAD の二つの表示を確認します。<br><br>2-8. 一方の [Distinguished Name] 設定を選択します。<br><br>2-9. 表示された [Connector Space Object Properties] の設定全体が見えるように画面キャプチャを取得します。<br><br>2-10 [Close] を押し、先ほど選択しなかった、もう一方の [Connector Space Object Properties] についても画面キャプチャを取得します。<br></p>
<h1 id="3-Synchronization-Service-Manager-のエラー画面ショット"><a href="#3-Synchronization-Service-Manager-のエラー画面ショット" class="headerlink" title="3.Synchronization Service Manager のエラー画面ショット"></a>3.Synchronization Service Manager のエラー画面ショット</h1><p>Azure AD Connect の Synchronization Service Manager にてエラーが発生しているか確認し、エラーが生じている場合にはその画面情報を取得します。</p>
<p>確認する箇所は[Operations] を選択して、[Status]が success でないものについて、画面右下のリンクをクリックしたときのすべての画面ショットを採取します。</p>
<h1 id="4-イベント-ログ"><a href="#4-イベント-ログ" class="headerlink" title="4.イベント ログ"></a>4.イベント ログ</h1><p>Azure AD Connect サーバーに管理者権限でサインインし、作業を実施ください。</p>
<p>4-1. コマンド プロンプトを管理者として起動して、以下の 2 つのコマンドを実行します。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil epl system <span class="variable">%UserProfile%</span>\desktop\SysEvent.evtx</span><br><span class="line">wevtutil epl Application <span class="variable">%UserProfile%</span>\desktop\AppEvent.evtx</span><br></pre></td></tr></table></figure>
<p>4-2. デスクトップに作成された evtx 形式のイベント ログを採取します。</p>
<h1 id="エラーログの出力確認"><a href="#エラーログの出力確認" class="headerlink" title="エラーログの出力確認"></a>エラーログの出力確認</h1><p>Azure AD Connect 上でコマンドプロンプトを管理者権限で実行します。<br>&lt;C:\Program Files\Microsoft Azure AD Sync\Bin&gt; にある、csexport.exe  を使用して、以下の 4 つのコマンドを実行します。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">csexport.exe "&lt;コネクター スペース名(Azure AD)&gt;" error_YYYYMMDD_1.xml /f:e </span><br><span class="line"> </span><br><span class="line">csexport.exe "&lt;コネクター スペース名(Azure AD)&gt;" error_YYYYMMDD_2.xml /f:i</span><br><span class="line"> </span><br><span class="line">csexport.exe "&lt;コネクター スペース名(オンプレ AD)&gt;" error_YYYYMMDD_3.xml /f:e </span><br><span class="line"> </span><br><span class="line">csexport.exe "&lt;コネクター スペース名(オンプレ AD)&gt;" error_YYYYMMDD_4.xml /f:i</span><br></pre></td></tr></table></figure>
<p>※コネクター スペース名については、Synchronization Service Manager [Operations]の [Name] に表示された名前です。</p>
<p>「コミュニティにおけるマイクロソフト社員による発言やコメントは、マイクロソフトの正式な見解またはコメントではありません。」<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/10/24/azure-active-directory-connect/problem-user-synchronize/" data-id="cjtqwo5u3001re4ytgpppdqaa" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/サポート/">サポート</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/情報採取/">情報採取</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-azure-active-directory-connect/upn-hard-match" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="../../2017/10/05/azure-active-directory-connect/upn-hard-match/" class="article-date">
  <time datetime="2017-10-04T15:00:00.000Z" itemprop="datePublished">2017-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="../../2017/10/05/azure-active-directory-connect/upn-hard-match/">Azure AD (Office 365) 上のユーザーをオンプレミス Active Directory ユーザーと紐付ける方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>こんにちは、Azure &amp; Identity サポート チームです。</p>
<p>今回は Azure AD (Office 365) 上のユーザーをオンプレミス Active Directory ユーザーと紐付ける方法の一つで、ハードマッチと呼ばれる方法についてご紹介します。</p>
<p>既に Azure AD 上にユーザー アカウントが存在している状態で、そのユーザーを後からオンプレミスの Active Directory (AD) に追加し、同期をおこなうときにその既存のアカウントをそのまま利用したいということがあると思います。</p>
<p>このようなケースではオンプレミス AD で対象となるアカウントのメール アドレス、または UPN 名を一致させた上で同期をおこなうという手法が一般的には取られます (これをソフトマッチと呼びます)。このソフトマッチができない場合 (UPN 名が異なるアカウントを紐づける必要がある場合など) にはハード マッチと呼ばれる方法で直接的に同期時にオブジェクトの一意性を確保する ID 情報 Immutable ID を紐づけます。</p>
<p>Azure AD Connect の既定の構成では、オンプレミス AD の ObjectGUID (バージョン 1.1.486.0 以前) あるいは msDS-ConsistencyGuid (バージョン 1.1.524.0 以降) を Base64 でエンコードした値を Immutable ID (source Anchor) として紐づけています。</p>
<p>以下では Azure AD Connect で ObjectGUID を ImmutableId と紐づける構成とている場合においてハードマッチによる同期をおこなう設定をご紹介します。</p>
<p>ただし、基本的にはユーザーを紐付ける必要がある場合には、ソフトマッチを利用することを推奨します。</p>
<p>理由としましては、ハードマッチによるユーザーの紐づけの変更を複数回行った場合などに Azure 上での情報の伝搬がされ終えないうちに新しい情報が伝搬され、Azure を構成するサーバー上での情報に不整合が生じ、問題が発生することが想定されるためであり、過去の実績という観点からもハードマッチを実施したような事例も少ないため、基本的にはハードマッチでの紐づけはできる限りしないことをお勧めします。</p>
<h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><ol>
<li>オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認します</li>
<li>Azure AD 上で ImmutableId が設定されてないことを確認します</li>
<li>Azure AD 上のアカウントに ImmutableId を手動で設定します</li>
<li>手動で差分ディレクトリ同期を実施します</li>
</ol>
<ul>
<li>4 を除き、同期処理が止まっている状態で作業をご実施ください。同期処理が止まっていないと紐づけしたいオンプレミス AD のアカウントが同期されてしまい、Immutable ID を紐づけできません。</li>
</ul>
<h3 id="1-オンプレミス-AD-にて-Base64-でエンコードされた-ObjectGUID-を確認"><a href="#1-オンプレミス-AD-にて-Base64-でエンコードされた-ObjectGUID-を確認" class="headerlink" title="1. オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認"></a>1. オンプレミス AD にて Base64 でエンコードされた ObjectGUID を確認</h3><p>オンプレミス上の紐づけ対象のアカウントの GUID 情報を取得します。</p>
<ol>
<li>オンプレミス Active Directory の任意の DC 上で [管理ツール] - [Active Directory ユーザーとコンピューター] を開きます。</li>
<li>メニューから [表示] - [拡張機能] にチェックを入れます。</li>
<li>該当ユーザー アカウントのプロパティを開きます。</li>
<li>[属性エディター] タブを開き、”distinguishedName” 値を選択し、[表示] をクリックします。</li>
<li>distinguishedName 値 (以下、DN 値) の内容をコピーします。</li>
<li>コマンド プロンプト (PowerShell でも可) を起動し、以下のコマンドを実行します。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldifde -f c:\ ldifde_user.txt -d &quot;手順 5. でコピーした内容&quot; -p subtree</span><br></pre></td></tr></table></figure>
<p>コマンド例：</p>
<img src="/blog/2017/10/05/azure-active-directory-connect/upn-hard-match/hardmatch_11.png">
<p>1-7. 出力されたファイルを開き、ObjectGUID の値を確認します。<br>出力結果例：</p>
<img src="/blog/2017/10/05/azure-active-directory-connect/upn-hard-match/hardmatch_2.png">
<h2 id="2-Azure-AD-上で-ImmutableId-が設定されてないことを確認"><a href="#2-Azure-AD-上で-ImmutableId-が設定されてないことを確認" class="headerlink" title="2. Azure AD 上で ImmutableId が設定されてないことを確認"></a>2. Azure AD 上で ImmutableId が設定されてないことを確認</h2><p>Azure AD の紐づけ対象のアカウントに ImmutableId が設定されていないことを確認します。ImmutableId が設定されている場合には、すでに同期対象となっていることを示します。</p>
<ol>
<li>インターネットに接続している任意のコンピューター上で “Windows PowerShell 用 Windows Azure Active Directory モジュール” を管理者として実行します。</li>
<li>起動した PowerShell にて Connect-MsolService コマンドを実行します。<br>※ 認証ダイアログが表示されますので、管理者ユーザーの資格情報を入力して [OK] ボタンをクリックします。</li>
<li>下記のコマンドを実行します。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-MsolUser -UserPrincipalName &quot;対象ユーザーの UPN&quot; | fl</span><br></pre></td></tr></table></figure>
<p>コマンド例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-MsolUser -UserPrincipalName &quot;hm_test3@test01.onmicrosoft.com&quot; | fl</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>出力されたファイルを開き、ImmutableId の値を確認します。</li>
</ol>
<p>出力結果例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImmutableId                            : （クラウド内ユーザーの場合、空白になります）</span><br><span class="line">UserPrincipalName                      : hm_test3@test01.onmicrosoft.com</span><br></pre></td></tr></table></figure>
<h3 id="3-ImmutableId-を手動で設定"><a href="#3-ImmutableId-を手動で設定" class="headerlink" title="3. ImmutableId を手動で設定"></a>3. ImmutableId を手動で設定</h3><p>ディレクトリ同期ツールにて、ユーザーの情報を関連付けるには下記の情報を使用します。<br>オンプレミス AD 側：objectGUID<br>Azure AD 側：ImmutableId</p>
<ol>
<li>インターネットに接続している任意のコンピューター上で “Windows PowerShell 用 Windows Azure Active Directory モジュール” を管理者として実行します。</li>
<li>起動した PowerShell にて Connect-MsolService コマンドを実行します。<br>※認証ダイアログが表示されますので、管理者ユーザーの資格情報を入力して [OK] ボタンをクリックします。</li>
<li>下記のコマンドを実行します。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-MsolUser -UserPrincipalName &lt;対象ユーザーの UPN&gt; -ImmutableId &lt;オンプレ AD ユーザーの  Base64 エンコードされた objectGUID 値&gt;</span><br></pre></td></tr></table></figure>
<p>コマンド実行例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-MsolUser -UserPrincipalName hm_test3@test01.onmicrosoft.com -ImmutableId 2/9JCtHr0EmH+hL07o11vA==</span><br></pre></td></tr></table></figure>
<p>3-4. 下記のコマンドを実行します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-MsolUser -UserPrincipalName &quot;対象ユーザーの UPN&quot; | fl</span><br></pre></td></tr></table></figure>
<p>コマンド例：</p>
<img src="/blog/2017/10/05/azure-active-directory-connect/upn-hard-match/hardmatch_3.png">
<h3 id="4-手動で差分ディレクトリ同期を実施"><a href="#4-手動で差分ディレクトリ同期を実施" class="headerlink" title="4. 手動で差分ディレクトリ同期を実施"></a>4. 手動で差分ディレクトリ同期を実施</h3><p>※2016 年 2 月に公開された新しいバージョン（1.1.105.0 以上）の Azure AD Connectを使用した手順をご案内いたします。</p>
<ol>
<li>ディレクトリ同期サーバーに管理者権限でログインします。</li>
<li>管理者の PowerShell を起動して、以下のコマンドを実行します。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-ADSyncSyncCycle -PolicyType Delta</span><br></pre></td></tr></table></figure>
<p>*今回ご紹介しているケースのように Azure AD Connect が構成済みである場合は上記コマンドで差分同期をすることとなります。</p>
<ol start="3">
<li>Office 管理ポータルで作業対象ユーザーの [同期の種類] が [クラウド] から [Active Directory ] に変わったことを確認します。</li>
</ol>
<p>「コミュニティにおけるマイクロソフト社員による発言やコメントは、マイクロソフトの正式な見解またはコメントではありません。」</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jpazureid.github.io/2017/10/05/azure-active-directory-connect/upn-hard-match/" data-id="cjtqwo5u7001we4ytb70wa2ku" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Hard-match/">Hard match</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/UPN/">UPN</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="../4/">&laquo; 戻る</a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../3/">3</a><a class="page-number" href="../4/">4</a><span class="page-number current">5</span><a class="page-number" href="../6/">6</a><a class="extend next" rel="next" href="../6/">次へ &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AAD-Connect/">AAD Connect</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AD-FS/">AD FS</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/AD-Sync/">AD Sync</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD/">Azure AD</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Application-Proxy/">Azure AD Application Proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-B2B/">Azure AD B2B</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-Directory-Rolls/">Azure AD Directory Rolls</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Azure-AD-License/">Azure AD License</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/CBA/">CBA</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Conditional-Access/">Conditional Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/ExpressRoute/">ExpressRoute</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Hard-match/">Hard match</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Hybrid-Azure-AD-Join/">Hybrid Azure AD Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Intune/">Intune</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/MFA/">MFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/OAuth/">OAuth</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/PowerShell/">PowerShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/RBAC/">RBAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Security/">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Sgin-in-log/">Sgin-in log</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Smart-lockout/">Smart lockout</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Subscription/">Subscription</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Tenant-Restrictions/">Tenant Restrictions</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Token/">Token</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/UPN/">UPN</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Windows-Defender-ATP/">Windows Defender ATP</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Workplace-Join/">Workplace Join</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/graph-api/">graph api</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/signin-log/">signin log</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/サポート/">サポート</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/トラブルシューティング/">トラブルシューティング</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/情報採取/">情報採取</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/証明書認証/">証明書認証</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="../../tags/AAD-Connect/" style="font-size: 18.33px;">AAD Connect</a> <a href="../../tags/AD-FS/" style="font-size: 16.67px;">AD FS</a> <a href="../../tags/AD-Sync/" style="font-size: 10px;">AD Sync</a> <a href="../../tags/Azure-AD/" style="font-size: 20px;">Azure AD</a> <a href="../../tags/Azure-AD-Application-Proxy/" style="font-size: 10px;">Azure AD Application Proxy</a> <a href="../../tags/Azure-AD-B2B/" style="font-size: 13.33px;">Azure AD B2B</a> <a href="../../tags/Azure-AD-Directory-Rolls/" style="font-size: 10px;">Azure AD Directory Rolls</a> <a href="../../tags/Azure-AD-License/" style="font-size: 10px;">Azure AD License</a> <a href="../../tags/CBA/" style="font-size: 10px;">CBA</a> <a href="../../tags/Conditional-Access/" style="font-size: 15px;">Conditional Access</a> <a href="../../tags/ExpressRoute/" style="font-size: 10px;">ExpressRoute</a> <a href="../../tags/Hard-match/" style="font-size: 10px;">Hard match</a> <a href="../../tags/Hybrid-Azure-AD-Join/" style="font-size: 10px;">Hybrid Azure AD Join</a> <a href="../../tags/Intune/" style="font-size: 11.67px;">Intune</a> <a href="../../tags/MFA/" style="font-size: 10px;">MFA</a> <a href="../../tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="../../tags/PowerShell/" style="font-size: 10px;">PowerShell</a> <a href="../../tags/RBAC/" style="font-size: 11.67px;">RBAC</a> <a href="../../tags/Security/" style="font-size: 11.67px;">Security</a> <a href="../../tags/Sgin-in-log/" style="font-size: 10px;">Sgin-in log</a> <a href="../../tags/Smart-lockout/" style="font-size: 10px;">Smart lockout</a> <a href="../../tags/Subscription/" style="font-size: 10px;">Subscription</a> <a href="../../tags/Tenant-Restrictions/" style="font-size: 10px;">Tenant Restrictions</a> <a href="../../tags/Token/" style="font-size: 10px;">Token</a> <a href="../../tags/UPN/" style="font-size: 10px;">UPN</a> <a href="../../tags/Windows-Defender-ATP/" style="font-size: 10px;">Windows Defender ATP</a> <a href="../../tags/Workplace-Join/" style="font-size: 10px;">Workplace Join</a> <a href="../../tags/graph-api/" style="font-size: 11.67px;">graph api</a> <a href="../../tags/signin-log/" style="font-size: 11.67px;">signin log</a> <a href="../../tags/サポート/" style="font-size: 11.67px;">サポート</a> <a href="../../tags/トラブルシューティング/" style="font-size: 11.67px;">トラブルシューティング</a> <a href="../../tags/情報採取/" style="font-size: 11.67px;">情報採取</a> <a href="../../tags/証明書認証/" style="font-size: 10px;">証明書認証</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2017/10/">十月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../2019/03/27/azure-active-directory-connect/introduction-staging-server/">(no title)</a>
          </li>
        
          <li>
            <a href="../../2019/02/04/azure-active-directory/how-to-get-sign-in-logs/">Azure AD サインイン ログ取得方法まとめ</a>
          </li>
        
          <li>
            <a href="../../2018/12/12/azure-active-directory/last-signin-reports/">PowerShell にて全ユーザーの最終サインイン日時を一括で取得する方法</a>
          </li>
        
          <li>
            <a href="../../2018/11/01/azure-active-directory/create-subscription-error/">サブスクリプション作成時のエラー「アカウントが Azure サブスクリプションに関連付けられないディレクトリに属しています。別のアカウントでサインインしてください」</a>
          </li>
        
          <li>
            <a href="../../2018/11/01/active-directory-federation-service/adfs-cba-ts/">証明書認証のトラブルシューティング</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Azure Identity Support Japan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../../fancybox/jquery.fancybox.css">
  <script src="../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../js/script.js"></script>



  </div>
</body>
</html>